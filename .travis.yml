language: node_js
node_js:
  - "12.13.0"
os:
  - linux
  - osx
  - windows
before_install:
  - 'if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y libc6-dev-i386 gcc-multilib g++-multilib        ; fi'
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" && \"$TRAVIS_PULL_REQUEST\" = \"false\" ]]; then curl -H 'Cache-Control: no-cache' https://raw.githubusercontent.com/fossas/fossa-cli/master/install.sh | sudo bash; fi"
  - 'if [[ "$TRAVIS_PULL_REQUEST" = "false" ]]; then npm install -g snyk; fi'

before_script:
  - npm install
  - 'if [[ "$TRAVIS_PULL_REQUEST" = "false" ]]; then snyk auth $SNYK_TOKEN; fi'
  - 'if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_PULL_REQUEST" = "false" ]]; then fossa init && fossa; fi'
  - mkdir prebuild-src
  - 'if [[ "$TRAVIS_OS_NAME" != "windows" ]]; then cp -R src/. prebuild-src/; fi'
  - 'if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then xcopy src prebuild-src //E //C //Q //Y; fi'
  - node prebuild-minify.js
  - cd prebuild-src
  - npm install
  - 'if [[ "$TRAVIS_PULL_REQUEST" = "false" ]]; then snyk protect; fi'
  - 'if [[ "$TRAVIS_PULL_REQUEST" = "false" ]]; then snyk test; fi'
  - cd ..

script:
  - 'if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./node_modules/.bin/electron-builder build -l -p never        ; fi'
  - 'if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./node_modules/.bin/electron-builder build -m -p never          ; fi'
  - 'if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then node_modules\\.bin\\electron-builder build -w -p never      ; fi'

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: s7x2Y1Dx3VHZa6l6eYjzc0hXVotAxAYzwaMVZ5EBSUPv/J44cn97dd3cDoWwfXcxIRhbCtxD6mRF3pD2PmnDrCG42raRSSKF51rTxJK2xdylV8V4klNM/3e2vaCBz+xfpu3/9IeQe61usRipxr0y8hpknfvamySj2Cmz3pZ89QeQjLgh62nWuudJCQUu0UcSXBle7lZNeVT9V504oUne+PlkiYmvhsRdl7XRy6yjh8QhdpQ8SyWE6toOqKcK3vNV/aG6m5yVyJYyyhy1WzBCr+rOeWcHcbZQ8W29/MF0xgCTHs8XTepGmho30171Zt4IMx9fr3fWao1vp74QMneFzEC2pL+kbM1nArfmbPp7Nq1M0xubfdIDqxMYJ4kiwDAE8umf2WB9EZosyUJYOtmWbq9ruYmVfUzetrS0omA7r6PQEWC8PiH8xK8+CzT76PI8rXA/4bFfkvQtVRLoFasVuNmhETHvDU1kxwftp7r167ouleD5yZjTzkUOK7Vr4xwggbzLkZE+injild04pVQUmcwhUCY9BvDJTPLGOxWyUvWBEIDwNvbVILlElUAtW0r3DKv+5oZjDXtEZ9qviD9QNA/acYvVJumo0DztuYqNLLmM89qv8rkZI9JDsBanFvCTwHpVgDe3WUNdrzJJUI3JSaG6ui8OvASbFYtPwDnztP8=
  file:
    - "dist/Buzzinga Linux (i386).AppImage"
    - "dist/Buzzinga Linux (x86_64).AppImage"
    - "dist/Buzzinga.dmg"
    - "dist/Buzzinga Windows Installer.exe"
  options:
    draft: true
  on:
    repo: chloe-lam/edex-ui
    branch: master
    tags: true